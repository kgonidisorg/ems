# Test configuration for integration tests
spring:
  # Database configuration - will be overridden by TestContainers
  datasource:
    url: jdbc:postgresql://localhost:5432/test
    username: test
    password: test
    driver-class-name: org.postgresql.Driver
  
  # JPA configuration
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: false
    properties:
      hibernate:
        format_sql: false
    database-platform: org.hibernate.dialect.PostgreSQLDialect
  
  # Disable Spring Boot DevTools
  devtools:
    restart:
      enabled: false
  
  # Disable WebSocket auto-configuration for tests
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration
      - org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration
  
  # Kafka configuration for embedded testing
  kafka:
    bootstrap-servers: ${spring.embedded.kafka.brokers}
    consumer:
      group-id: device-service-test
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring:
          json:
            trusted:
              packages: "*"
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer

# MQTT configuration (will be overridden in tests)
mqtt:
  broker:
    url: tcp://localhost:1883
  client:
    id: device-service-test

# Logging configuration for tests
logging:
  level:
    com.ecogrid: DEBUG
    org.springframework.kafka: WARN
    org.apache.kafka: WARN
    org.testcontainers: INFO
    io.moquette: WARN